<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <style>
    .map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/css/ol.css"
    type="text/css" />
  <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.14.1/build/ol.js"></script>
  <title>OpenLayers example</title>
</head>

<body>
  <button onclick="addTMS()">添加TMS服务</button>
  <div id="map" class="map"></div>
  <script type="text/javascript">
    let map = new ol.Map({
      target: "map",
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM(),
        }),
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([116.39392, 39.916927]),
        zoom: 12,
      }),
    });
    addTMS = () => {
      const extent = [-20037508.34, -20037508.34, 20037508.34, 20037508.34];
      const tileSize = [256, 256];
      const origin = [-20037508.34, 34, 20037508.34];
      const resolutions = [156543.03390625, 78271.516953125, 39135.7584765625, 19567.87923828125,
        9783.939619140625, 4891.9698095703125, 2445.9849047851562, 1222.9924523925781,
        611.4962261962891, 305.74811309814453, 152.87405654907226, 76.43702827453613,
        38.218514137268066, 19.109257068634033, 9.554628534317017, 4.777314267158508,
        2.388657133579254, 1.194328566789627, 0.5971642833948135
      ];
      const matrixIds = ['EPSG:900913:0', 'EPSG:900913:1', 'EPSG:900913:2',
        'EPSG:900913:3', 'EPSG:900913:4', 'EPSG:900913:5', 'EPSG:900913:6',
        'EPSG:900913:7', 'EPSG:900913:8', 'EPSG:900913:9', 'EPSG:900913:10',
        'EPSG:900913:11', 'EPSG:900913:12', 'EPSG:900913:13', 'EPSG:900913:14',
        'EPSG:900913:15', 'EPSG:900913:16', 'EPSG:900913:17', 'EPSG:900913:18'];
      //自定义网格
      const tileGrid = new ol.tilegrid.TileGrid({
        extent: extent,
        tileSize: tileSize,
        origin: origin,
        resolutions: resolutions,
        matrixIds: matrixIds,
      });
      let xyzLayer = new ol.layer.Tile({
        source: new ol.source.XYZ({
          crossOrigin: 'anonymous',
          projection: "EPSG:900913",
          tileGrid: tileGrid,
          tileUrlFunction: function (tileCoord) {
            let z = tileCoord[0];
            let x = tileCoord[1];
            let y = -tileCoord[2] - 1;
            return ("http://localhost:8090/geoserver/gwc/service/wmts/" + z + "/" + y + "/" + x);
          },
          wrapX: true,
        }),
      });
      map.addLayer(xyzLayer);
    }
  </script>
</body>

</html>